% Shear/apply tension to Astral Mikado networks
% --> for plotting timeseries of deformation and making movies
% Brady Berg, 2025-10-14

% max shear force in sweeps: 1.25 pN
% max tension in sweeps: 5 pN


set simul system
{
    time_step = 0.1
    viscosity = 0.5
    kT = 0.0042
    verbose = 0
    random_seed = 288424723
}

set space cell
{
    shape = rectangle
}


new cell
{
    length = 1,1 
}


set fiber actin
{
    rigidity       = 0.01
    segmentation   = 0.02
    confine        = off %inside,200
    min_length     = 0.1  
    activity       = none
}

% force will be applied to this fiber type
set fiber forced_fiber
{
    rigidity = 500
    segmentation = 0.05
    confine = off %inside,200
    min_length = 1
    activity = none
}

% fiber type to be anchored to the bottom of simulation space
set fiber base_fiber
{
    rigidity = 500
    segmentation = 0.05
    confine = off %inside,200
    min_length = 1
    activity = none
}

% define anchoring object
set hand strong_hand
{
    unbinding_rate = 0
    unbinding_force = inf
    display = ( size = 10; color=blue)
}

set single pivot
{
    hand = strong_hand
    stiffness = 500
    activity = fixed
}

set single temp_pivot
{
    hand = strong_hand
    stiffness = 500
    activity = fixed
}

% for visualizing center of asters
set solid core
{
    display = ( style=1; color=(1 0 0 0.33); size=1; ) % (r g b alpha)
}

set aster actinNode
{
    stiffness = 500, 250 
}

include display.cyp { required=0 }

% initialize asters

% target density N*fiber_len / A: 75

% target number of filaments: 750


new 750 actinNode
{
    type = astral
    solid = core
    radius = 0.03
    % point1 = center, 0.3
    fibers = 1, actin, ( length = 0.1;  end_state = static,static;)
}

% initialize fibers at top and bottom of simulation space
new 1 forced_fiber
{
    length = 1
    position = 0 0.499 0
    orientation = 1 0 0     % "point" fiber to the right
     % Temporarily anchor rforced_fiber while network crosslinks
    % syntax: `attach# = [object], [distance from reference to other end], [reference]
    attach1 = temp_pivot, 0, minus_end
    attach2 = temp_pivot, 0.5, minus_end
    attach3 = temp_pivot, 0, plus_end
}

new 1 base_fiber
{
    length = 1
    position = 0 -0.499 0
    orientation = -1 0 0    % "point" fiber to the left
    % syntax below is `attach# = [object] [distance from reference to other end] [reference]
    attach1 = pivot, 0, minus_end
    attach2 = pivot, 0.1, minus_end
    attach3 = pivot, 0.2, minus_end
    attach4 = pivot, 0.3, minus_end
    attach5 = pivot, 0.4, minus_end
    attach6 = pivot, 0.5, minus_end
    attach7 = pivot, 0.6, minus_end
    attach8 = pivot, 0.7, minus_end
    attach9 = pivot, 0.8, minus_end
    attach10 = pivot, 0.9, minus_end
    attach11 = pivot, 0, plus_end
}

% define crosslinkers
set hand binder
{
	binding_rate = 1
	binding_range = 0.001
	unbinding_rate = 0
    display = {width = 10; color = (1 1 0)}
}
set couple crosslinker
{
	hand1 = binder
	hand2 = binder
	stiffness = 50
	diffusion = 1
}
new 22500 crosslinker {attach1 = actin}

% place crosslinkers near top and bottom to ensure
% they connect to the top and bottom filaments
new 100 crosslinker {attach1 = forced_fiber}
% {
%     position = surface
%     placement = surface,, (y > 0.49)
% }

new 100 crosslinker {attach1 = base_fiber}
% {
%     position = surface
%     placement = surface,, (y < -0.49)
% }

% run system with no force; allows crosslinkers to bind
run system
{
    nb_steps = 500
    nb_frames = 50  % note: 10x higher framerate than standard sims
}

% apply either a shear or a tensile stress; (minus_x, minus_y, plus_x, plus_y)
% (0, 0, 1.25, 0)
change fiber forced_fiber
{
    minus_end_force = 0 0
    plus_end_force = 1.25 0
}
% remove anchors on forced_fiber
delete 3 temp_pivot

run system
{
    nb_steps = 3500
    nb_frames = 350 % note: 10x higher framerate than standard sims
}

% report, framewise, network position over entire simulation -> needs to be done outside of .cym
